{"version":3,"file":"keyconfig.min.js","sources":["keyconfig.js"],"names":["e","t","n","r","s","o","u","a","f","l","require","i","Error","code","exports","call","length",1,"module","keyconfig","obj","this","models","_","map","keymaps","name","keymapset","_inherits","prototype","window",2,"fletcher16","keycode","arr","Array","isArray","isString","split","sort",3,"_methods","_attr_methods","proto","methods","attr_methods","each","method","args","slice","arguments","unshift","apply","value","context","iterator","isFunction","model","get",4,"keymap","extend","description","binding","options","enabled","readonly","hidden","keys_win","keys_mac","sums_win","sums_mac","_e","Emitter","on","_reset_binding","bind","_reset","checksum","EventEmitter","_KEYCODE_ATTRS","_KEYCODE_SUM_ATTRS","uniq","object","_UPDATE_WHITELIST","update","pick","self","keys","key","emit","_JSON_WHITELIST","toJSON",5,"_add","_validate","prop","list","collisions","chain","pluck","flatten","without","undefined","intersection","indexOf","filter","push",6,"buf","tlen","sum1","sum2","len",7,"backspace","command","tab","clear","enter","shift","ctrl","alt","capslock","escape","esc","space","pageup","pagedown","end","home","left","up","right","down","del","comma","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12",",",".","/","`","-","=",";","[","\\","]","'","toLowerCase","toUpperCase","charCodeAt"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nvar keymapset = require(5);\nvar _inherits = require(3);\n\nmodule.exports = keyconfig;\n_inherits(keyconfig.prototype);\n\nif ('object' === typeof window)\n  window.keyconfig = module.exports;\n\nfunction keyconfig (obj) {\n  if (!(this instanceof keyconfig)) return new keyconfig(obj);\n  this.models = _.map(obj, function (keymaps, name) {\n    return keymapset(name, keymaps);\n  });\n}\n},{}],2:[function(require,module,exports){\nvar fletcher16 = require(6);\nvar keycode = require(7);\n\n\nmodule.exports = function (arr) {\n  if (Array.isArray(arr)) {\n    return arr.map(function (s) {\n      if (_.isString(s)) \n        return fletcher16(_.map(s.split('+'), keycode).sort());\n    });\n  }\n};\n},{}],3:[function(require,module,exports){\nvar _methods = ['forEach', 'each', 'map', 'collect', 'reduce', 'foldl',\n    'inject', 'reduceRight', 'foldr', 'find', 'detect', 'filter', 'select',\n    'reject', 'every', 'all', 'some', 'any', 'include', 'contains', 'invoke',\n    'max', 'min', 'toArray', 'size', 'first', 'head', 'take', 'initial', 'rest',\n    'tail', 'drop', 'last', 'without', 'difference', 'indexOf', 'shuffle',\n    'lastIndexOf', 'isEmpty', 'chain', 'sample'];\n\nvar _attr_methods = ['groupBy', 'countBy', 'sortBy', 'indexBy'];\n\nmodule.exports = function (proto, methods, attr_methods) {\n  methods = methods || _methods;\n  attr_methods = attr_methods || _attr_methods;\n\n  _.each(methods, function (method) {\n    if (!_[method]) return;\n    proto[method] = function () {\n      var args = Array.prototype.slice.call(arguments);\n      args.unshift(this.models);\n      return _[method].apply(_, args);\n    };\n  });\n\n  _.each(attr_methods, function (method) {\n    proto[method] = function(value, context) {\n      var iterator = _.isFunction(value) ? value : function(model) {\n        if (_.isFunction(model.get)) return model.get(value);\n        else return model[value];\n      };\n      return _[method](this.models, iterator, context);\n    };\n  });\n};\n},{}],4:[function(require,module,exports){\nvar checksum = require(2);\n\nvar Emitter = require('events').EventEmitter;\n\nmodule.exports = keymap;\n\nfunction keymap (obj) {\n  if (!(this instanceof keymap)) return new keymap(obj);\n  if (!obj.name) throw new Error('missing name');\n  _.extend(this, {\n    name: null, description: null, binding: null, options: null,\n    enabled: true, readonly: false, hidden: false, \n    keys_win: null, keys_mac: null,\n    sums_win: null, sums_mac: null\n  }, obj);\n  this._e = new Emitter;\n  this._e.on('update:binding', this._reset_binding.bind(this));\n  this._reset();\n}\n\nkeymap.prototype._reset = function () {\n  this._reset_binding();\n};\n\nkeymap._KEYCODE_ATTRS = ['keys_win', 'keys_mac'];\nkeymap._KEYCODE_SUM_ATTRS = ['sums_win', 'sums_mac'];\n\nkeymap.prototype._reset_binding = function () {\n  if (!this.binding) return;\n  this.binding = _.map(this.binding, function (n) {\n    if (!n) return null;\n    return _.uniq(n, false);\n  });\n  _.extend(this, \n    _.object(keymap._KEYCODE_ATTRS, this.binding),\n    _.object(keymap._KEYCODE_SUM_ATTRS, \n      _.map(this.binding, checksum.bind(checksum)))\n  );\n};\n\nkeymap._UPDATE_WHITELIST = ['binding', 'description', 'hidden', 'enabled'];\n\nkeymap.prototype.update = function (obj) {\n  obj = _.pick(obj, keymap._UPDATE_WHITELIST);\n  _.extend(this, obj);\n  var self = this;\n  _.each(_.keys(obj), function (key) {\n    self._e.emit('update:' + key);\n  });\n};\n\nkeymap._JSON_WHITELIST = \n  ['name', 'description', 'binding', 'enabled', 'readonly', 'hidden'];\n\nkeymap.prototype.toJSON = function () {\n  return _.pick(this, keymap._JSON_WHITELIST);\n};\n},{}],5:[function(require,module,exports){\nvar _inherits = require(3);\nvar keymap = require(4);\n\nmodule.exports = keymapset;\n_inherits(keymapset.prototype);\n\nfunction keymapset (name, keymaps) {\n  if (!(this instanceof keymapset)) return new keymapset(name, keymaps);\n  if (!name) throw new Error('missing name');\n  this.name = name;\n  this.models = [];\n  _.each(keymaps, this._add.bind(this));\n}\n\nkeymapset.prototype._validate = function (model) {\n  var self = this;\n  _.each(keymap._KEYCODE_SUM_ATTRS, function (prop, i) {\n    if (model[prop]) {\n      var list = self.chain().pluck(prop).flatten().without(undefined, null);\n      var collisions = list.intersection(model[prop]).value();\n      if (collisions.length) {\n        if (model.readonly) {\n          throw new Error('dup: ' + model.name + ' (' + prop.split('_')[1] + ')');\n        }\n        else {\n          collisions = _.map(collisions, function (n) {\n            return model[prop].indexOf(n);\n          });\n          var binding = model.binding;\n          binding[i] = _.filter(binding[i], function (n, i) {\n            return !~collisions.indexOf(i);\n          });\n          model.update({ binding: binding });\n        }\n      }\n    }\n  });\n  return model;\n};\n\nkeymapset.prototype._add = function (obj) {\n  var model = obj;\n  if (!(obj instanceof keymap)) model = keymap(obj);\n  model = this._validate(model);\n  this.models.push(model);\n};\n\nkeymapset.prototype.toJSON = function () {\n  return this.map(function (model) { return model.toJSON(); });\n};\n},{}],6:[function(require,module,exports){\nvar exports = module.exports = fletcher16;\nexports.fletcher16 = fletcher16;\n\nfunction fletcher16(buf) {\n  var sum1 = 0xff, sum2 = 0xff;\n  var i = 0;\n  var len = buf.length;\n\n  while (len) {\n    var tlen = len > 20 ? 20 : len;\n    len -= tlen;\n    do {\n      sum2 += sum1 += buf[i++];\n    } while (--tlen);\n    sum1 = (sum1 & 0xff) + (sum1 >> 8);\n    sum2 = (sum2 & 0xff) + (sum2 >> 8);\n  }\n  /* Second reduction step to reduce sums to 8 bits */\n  sum1 = (sum1 & 0xff) + (sum1 >> 8);\n  sum2 = (sum2 & 0xff) + (sum2 >> 8);\n  return sum2 << 8 | sum1;\n}\n},{}],7:[function(require,module,exports){\nvar map = {\n    backspace: 8\n  , command: 91\n  , tab: 9\n  , clear: 12\n  , enter: 13\n  , shift: 16\n  , ctrl: 17\n  , alt: 18\n  , capslock: 20\n  , escape: 27\n  , esc: 27\n  , space: 32\n  , pageup: 33\n  , pagedown: 34\n  , end: 35\n  , home: 36\n  , left: 37\n  , up: 38\n  , right: 39\n  , down: 40\n  , del: 46\n  , comma: 188\n  , f1: 112\n  , f2: 113\n  , f3: 114\n  , f4: 115\n  , f5: 116\n  , f6: 117\n  , f7: 118\n  , f8: 119\n  , f9: 120\n  , f10: 121\n  , f11: 122\n  , f12: 123\n  , ',': 188\n  , '.': 190\n  , '/': 191\n  , '`': 192\n  , '-': 189\n  , '=': 187\n  , ';': 186\n  , '[': 219\n  , '\\\\': 220\n  , ']': 221\n  , '\\'': 222\n};\n\n/**\n * find a keycode.\n *\n * @param {String} name\n * @return {Number}\n */\n\nmodule.exports = function(name){\n  return map[name.toLowerCase()] || name.toUpperCase().charCodeAt(0);\n};\n},{}]},{},[1]);\n"]}